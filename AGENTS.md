# AIエージェントとの協業

このドキュメントでは、SHINJU DATEプロジェクトの開発プロセスにおけるAIエージェントの役割と、それらを効果的に活用するためのベストプラクティスを説明します。

## 概要

本プロジェクトの開発では、複数のAIツールを積極的に活用しています。AIエージェントは開発者の生産性を向上させ、コードの品質を高め、より効率的な開発フローを実現するための重要なパートナーです。

## プロジェクト環境

### パッケージマネージャー

このプロジェクトでは**pnpm**を採用しています。依存関係の管理やスクリプトの実行には`pnpm`コマンドを使用してください。

- 依存関係のインストール: `pnpm install`
- スクリプトの実行: `pnpm run <script-name>`
- パッケージの追加: `pnpm add <package-name>`

`npm`や`yarn`は使用せず、`package-lock.json`や`yarn.lock`ファイルも不要です。

### MSW (Mock Service Worker) の有効化

GitHub ActionsやGitHub CopilotなどのAIエージェント環境でAPIモックを有効にする場合は、環境変数 `ENABLE_MSW=true` を設定してください。

```bash
export ENABLE_MSW=true
```

この設定により、一貫したAPIレスポンスが提供され、AIエージェントがより精度の高いコード補完を行えるようになります。

#### MSWサービスワーカーの初期設定

MSWを初回使用する際、または `mockServiceWorker.js` ファイルが存在しない場合は、以下のコマンドでサービスワーカーファイルを生成してください：

```bash
# Web アプリの場合
cd apps/web && pnpm run msw:init

# Admin アプリの場合  
cd apps/admin && pnpm run msw:init
```

**注意**: `mockServiceWorker.js` ファイルは `.gitignore` に含まれており、必要に応じて各開発者が生成する必要があります。これは、MSWが生成する一時的なファイルであり、バージョン管理に含める必要がないためです。

### Python 開発環境 (Insights API)

`apps/insights` プロジェクトでは **uv** を使用して Python の依存関係を管理しています。

#### uv の基本コマンド

```bash
# 依存関係のインストール
cd apps/insights && uv sync --extra dev

# 開発サーバーの起動
cd apps/insights && uv run poe dev

# リンティングの実行
cd apps/insights && uv run poe lint

# フォーマットの実行  
cd apps/insights && uv run poe format

# フォーマットチェック（CI用）
cd apps/insights && uv run poe format-check
```

#### Python コード変更時の必須作業

**Python ファイルを変更した場合は、以下を必ず実行してください：**

```bash
cd apps/insights
uv run poe format  # フォーマット適用
uv run poe lint     # リンティングチェック
```

これらのコマンドを実行せずにコミットすると、CI で失敗する原因となります。

### 必須の品質チェック

**すべてのコード変更後の品質チェックは必須要件です。**

#### JavaScript/TypeScript の場合

`pnpm run check --fix` を実行してください。

このコマンドは以下を自動的に実行します：
- Biomeによるコードフォーマット
- リンティングチェックと自動修正
- 未使用インポートの削除
- コードスタイルの統一

#### Python (Insights API) の場合

```bash
cd apps/insights
uv run poe format  # フォーマット適用
uv run poe lint     # リンティングチェック
```

**AIエージェントは、いかなるコード変更を行った場合も、変更をコミットする前に必ず該当する品質チェックコマンドを実行してください。** これを怠ると、ビルド失敗や品質問題の原因となります。

## AIエージェントの種類と役割

### 対話・計画型エージェント（例: Google Gemini）

対話型AIエージェントは、高レベルの意思決定、設計、戦略立案において開発者をサポートします。

#### 主な用途

* **ブレインストーミング**: 新機能のアイデア出しや問題解決のアプローチを議論
* **アーキテクチャ設計**: システム設計やコンポーネント構成の検討
* **リファクタリング提案**: コードベースの改善や最適化の方針策定
* **ドキュメント作成**: 技術文書、README、Issue、プルリクエストの下書き作成
* **コードレビュー**: 包括的なコードレビューとフィードバックの提供
* **問題の診断**: 複雑なバグやパフォーマンス問題の分析

#### 活用のベストプラクティス

* 具体的な質問や明確なコンテキストを提供する
* 複数の選択肢や代替案を検討する
* AIの提案を批判的に評価し、プロジェクトの要件に照らして検証する
* 大きな決定事項は必ずチームメンバーとレビューする

### コード補完・実装型エージェント（例: GitHub Copilot）

コード補完型AIエージェントは、エディタ内でリアルタイムにコーディング作業を支援します。

#### 主な用途

* **定型コードの生成**: 繰り返しのパターンやボイラープレートコードの自動生成
* **関数の実装**: コメントや関数シグネチャから実装内容を提案
* **テストコードの作成**: 既存のコードに対するユニットテストの生成
* **コメントの自動生成**: コードの意図を説明するコメントの提案
* **リファクタリング**: 既存コードの改善や書き換えの支援
* **APIの活用**: ライブラリやフレームワークの正しい使用方法を提案

#### 活用のベストプラクティス

* 提案されたコードを必ず確認し、理解してから採用する
* プロジェクトのコーディング規約やスタイルガイドに従っているか確認する
* セキュリティ上の問題がないか検証する
* 生成されたテストが適切なカバレッジを持っているか確認する

## AIエージェント活用のベストプラクティス

### 1. 人間によるレビューと検証

**すべてのAI生成コードは、人間による慎重なレビューと検証が必要です。**

* AIの提案は開発の出発点であり、最終的な品質保証は人間の責任です
* コードの意図、ロジック、エッジケースを理解した上で採用する
* セキュリティ、パフォーマンス、保守性の観点から評価する

### 2. テストの実施

AI生成コードに対しても、通常のコードと同様に厳格なテスト基準を適用します。

* ユニットテストを作成し、期待される動作を検証する
* 統合テストで他のコンポーネントとの相互作用を確認する
* エッジケースや異常系のテストも含める

### 3. セキュリティの考慮

AIツールは必ずしもセキュリティベストプラクティスに従うとは限りません。

* 機密情報（APIキー、パスワード、個人情報など）が含まれていないか確認する
* 一般的な脆弱性（インジェクション、XSS、CSRFなど）がないか検証する
* 依存関係の更新や脆弱性スキャンを定期的に実施する

### 4. コンテキストの提供

AIエージェントにより良い提案をしてもらうために、適切なコンテキストを提供します。

* コメントで意図や要件を明確に説明する
* 関連するファイルやコードを参照できるようにする
* プロジェクトのコーディング規約やパターンを共有する

### 5. 継続的な学習

AIツールは常に進化しています。

* 新しい機能やベストプラクティスを積極的に学ぶ
* チーム内でAI活用の知見やTipsを共有する
* 効果的だった使い方や注意すべき点をドキュメント化する

## プロジェクト固有のガイドライン

### コードスタイル

* JavaScript/TypeScript: Biomeによるフォーマットとリンティングを必ず実行する
* Python (Insights API): Ruffによるフォーマットとリンティングを必ず実行する  
* AI生成コードも該当する品質チェックツールでチェックする
* プロジェクトの既存のパターンやコンベンションに従う

**重要**: AIエージェントは、コード変更後に必ず品質チェックコマンドを実行することが必須です。このコマンドを実行し忘れると、ビルドエラーやフォーマットの問題が発生し、プルリクエストの品質が低下します。

#### JavaScript/TypeScript の場合:
`pnpm run check --fix` を実行

#### Python (Insights API) の場合:
```bash
cd apps/insights
poetry run poe format
poetry run poe lint
```

特に以下の場合は必ず実行してください：

* コードファイルを新規作成・編集した後
* インポート文を追加・削除・変更した後  
* 型定義やインターフェイスを変更した後
* リファクタリングを行った後

この作業を怠ると、未使用のインポート、フォーマットの不整合、型エラーなどの問題が蓄積し、開発プロセスを大幅に遅らせる原因となります。

### コミットメッセージ

* AI支援で作成したコードも、通常通り明確で意味のあるコミットメッセージを記述する
* Conventional Commitsの形式に従う（例: `feat(web): add new feature`、`fix(insights): resolve API issue`、`refactor(admin): improve component`）
  * スコープは`apps/*`や`packages/*`にある各アプリやパッケージを単位とする
  * 1行目はGitHubのUIに収まる平易な英文で記述する
* 大きな変更は小さなコミットに分割する

### Pull Request

* AI生成コードを含むPull Requestでも、通常のレビュープロセスに従う
* Pull Requestのタイトルもコミットメッセージの1行目となるため、Conventional Commitsの形式に準じる
* 変更内容を明確に説明し、必要に応じてAIツールの使用方法を記載する

## 透明性とドキュメント化

### AIツールの使用を明示する

* 大規模なAI生成コードを含むプルリクエストでは、その旨を明記することを推奨します
* 特殊な使い方や考慮事項があれば、コメントやドキュメントに記載する

### 学習とフィードバック

* AIツールの効果的な使用例や、避けるべきパターンを共有する
* プロジェクトのニーズに合わせて、このドキュメントを更新し続ける

## まとめ

AIエージェントは、SHINJU DATEプロジェクトの開発を加速し、コードの品質を向上させる強力なツールです。しかし、AIは開発者を置き換えるものではなく、補助するものです。最終的な判断、品質保証、セキュリティの責任は常に人間にあります。

このガイドラインに従うことで、AIツールの利点を最大限に活用しながら、高品質で保守可能なコードベースを維持することができます。

---

このドキュメントに関するフィードバックや改善提案は、Issueやプルリクエストでお寄せください。
