name: Dev Container Test

on:
  pull_request:
    paths:
      - .devcontainer/**
      - .github/workflows/devcontainer-test.yml
  push:
    branches:
      - main
    paths:
      - .devcontainer/**
      - .github/workflows/devcontainer-test.yml
  workflow_dispatch:

jobs:
  devcontainer-test:
    name: Dev Container Test
    runs-on: ubuntu-24.04
    permissions:
      contents: read

    steps:
      - name: Checkout repository
        uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8 # v6.0.1

      - name: Install @devcontainers/cli
        run: npm install -g @devcontainers/cli

      - name: Start Dev Container
        run: |
          echo "ðŸš€ Starting Dev Container..."
          devcontainer up --workspace-folder .

      - name: Test Dev Container environment
        run: |
          echo "ðŸ§ª Testing Dev Container environment..."
          
          # Test Node.js availability
          devcontainer exec --workspace-folder . node --version
          
          # Test pnpm availability (via corepack)
          devcontainer exec --workspace-folder . pnpm --version
          
          # Test psql availability
          devcontainer exec --workspace-folder . psql --version
          
          # Test uv availability
          devcontainer exec --workspace-folder . uv --version

      - name: Test project dependency installation
        run: |
          echo "ðŸ“¦ Testing project dependency installation..."
          devcontainer exec --workspace-folder . pnpm install --frozen-lockfile
